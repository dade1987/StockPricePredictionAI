<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Cripto Prediction</title>
    <!-- Apache ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Vue.js -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
</head>
<body class="bg-gray-100 text-gray-800">
<div id="app" class="container mx-auto p-4">
    <h1 class="text-3xl font-bold mb-4">Previsioni Criptovalute</h1>
    <div class="mb-6 space-y-4">

        <div>
            <label for="symbol" class="block font-bold mb-1">Seleziona Criptovaluta</label>
            <select v-model="selectedSymbol" class="border p-2 rounded">
                <option v-for="crypto in cryptocurrencies" :value="crypto.value" :key="crypto.value">
                    {{ crypto.name }}
                </option>
            </select>
        </div>

        <div>
            <label for="interval" class="block font-bold mb-1">Seleziona Timeframe</label>
            <select v-model="selectedInterval" class="border p-2 rounded">
                <option v-for="interval in intervals" :value="interval.value" :key="interval.value">
                    {{ interval.label }}
                </option>
            </select>
        </div>

        <button @click="updatePredictions" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
            Aggiorna Previsioni
        </button>
    </div>

    <div id="cryptoChart" class="mb-8" style="height: 400px;"></div>
    <div id="lossChart" class="mb-8" style="height: 400px;"></div>
    <div id="testChart" class="mb-8" style="height: 400px;"></div>
</div>

<script>
    new Vue({
        el: '#app',
        data: {
            selectedSymbol: 'BTC',
            selectedInterval: '1d',
            cryptocurrencies: [
                { value: 'BTC', name: 'Bitcoin (BTC)' },
                { value: 'ETH', name: 'Ethereum (ETH)' },
                { value: 'DOGE', name: 'Dogecoin (DOGE)' },
                { value: 'XRP', name: 'XRP (XRP)' },
                { value: 'ADA', name: 'Cardano (ADA)' }
            ],
            intervals: [
                { value: '1m', label: '1m' },
                { value: '5m', label: '5m' },
                { value: '15m', label: '15m' },
                { value: '1h', label: '1h' },
                { value: '4h', label: '4h' },
                { value: '1d', label: '1d' }
            ]
        },
        methods: {
            async updatePredictions() {
                const results = await this.fetchResults(this.selectedSymbol, this.selectedInterval);
                this.plotResults(results);
            },
            async fetchResults(symbol, interval) {
                const response = await fetch(`/api/results?symbol=${symbol}&interval=${interval}`);
                const results = await response.json();
                return results;
            },
            plotResults(results) {
                // Grafico storico
                const historicalChart = echarts.init(document.getElementById('cryptoChart'));
                const historicalOption = {
                    title: {
                        text: 'Andamento Prezzo di Chiusura Storico'
                    },
                    tooltip: {
                        trigger: 'axis'
                    },
                    xAxis: {
                        type: 'category',
                        data: results.historical.map(d => new Date(d.date).toLocaleDateString())
                    },
                    yAxis: {
                        type: 'value',
                        name: 'Prezzo (USD)'
                    },
                    series: [{
                        data: results.historical.map(d => d.close),
                        type: 'line',
                        name: 'Prezzo di Chiusura Storico',
                        itemStyle: { color: 'blue' }
                    }]
                };
                historicalChart.setOption(historicalOption);

                // Grafico Errore di Addestramento
                const lossChart = echarts.init(document.getElementById('lossChart'));
                const lossOption = {
                    title: {
                        text: 'Andamento Errore di Addestramento'
                    },
                    tooltip: {
                        trigger: 'axis'
                    },
                    xAxis: {
                        type: 'category',
                        data: results.lossHistory.map((_, i) => i + 1)
                    },
                    yAxis: {
                        type: 'value',
                        name: 'Loss'
                    },
                    series: [{
                        data: results.lossHistory,
                        type: 'line',
                        name: 'Errore di Addestramento',
                        itemStyle: { color: 'green' }
                    }]
                };
                lossChart.setOption(lossOption);

                // Grafico Test + Predizioni
                const testChart = echarts.init(document.getElementById('testChart'));
                const testOption = {
                    title: {
                        text: 'Predizioni sui Dati di Testing e Future'
                    },
                    tooltip: {
                        trigger: 'axis'
                    },
                    xAxis: {
                        type: 'category',
                        data: [...results.testDates.map(d => new Date(d).toLocaleDateString()), 'Futuro']
                    },
                    yAxis: {
                        type: 'value',
                        name: 'Prezzo (USD)'
                    },
                    series: [
                        {
                            data: results.testActual,
                            type: 'line',
                            name: 'Dati di Testing',
                            itemStyle: { color: 'blue' }
                        },
                        {
                            data: results.testPredictions,
                            type: 'scatter',
                            name: 'Predizioni',
                            itemStyle: { color: 'red' }
                        },
                        {
                            data: [...Array(results.testPredictions.length).fill(null), results.futurePrediction],
                            type: 'scatter',
                            name: 'Predizione Futura',
                            itemStyle: { color: 'orange' }
                        }
                    ]
                };
                testChart.setOption(testOption);
            }
        },
        mounted() {
            this.updatePredictions();
        }
    });
</script>
</body>
</html>
